variables:
  R_LIBS_USER: '$(Agent.BuildDirectory)/R/library'
  CRAN: 'https://cloud.r-project.org'

resources:
  repositories:
    - repository: r-azure-pipelines
      type: github
      name: r-lib/r-azure-pipelines
      endpoint: tidymodels

jobs:
  - job: 'Linux'
    variables:
      CRAN: 'https://demo.rstudiopm.com/all/__linux__/xenial/latest'
      TZ: UTC
      CI: true
      KERAS_BACKEND: 'tensorflow'
    pool:
      vmImage: 'Ubuntu-16.04'
    strategy:
      matrix:
        R-3.4:
          containerImage: rstudio/r-base:3.4-xenial
        R-3.5:
          containerImage: rstudio/r-base:3.5-xenial
        R-3.6:
          containerImage: rstudio/r-base:3.6-xenial
    container: $[ variables['containerImage'] ]
    steps:
      - template: templates/r-setup-linux.yml@r-azure-pipelines
      - template: pkg-library.yml
      - bash: sudo apt-get -y install libnlopt-dev
      - template: pkg-install_dependencies.yml
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.6'
      - bash: |
          python -m pip install --upgrade --ignore-installed --user travis pip setuptools wheel virtualenv
          python -m pip install --upgrade --ignore-installed --user travis keras h5py pyyaml requests Pillow scipy theano
          R -e 'tensorflow::install_tensorflow()'
      - template: pkg-rcmd_check.yml
      - template: pkg-coverage.yml
        parameters:
          coverage: false
